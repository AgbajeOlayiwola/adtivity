{"version":3,"file":"adtivity-sdk.min.js","sources":["../src/autoTrackers/pageTracker.js","../src/utils/storage.js","../src/index.js","../src/autoTrackers/clickTracker.js"],"sourcesContent":["// adtivity-sdk/src/autoTrackers/pageTracker.js\n\n/**\n * Initializes automatic page view tracking for Single Page Applications (SPAs).\n * This function hooks into the browser's History API to detect URL changes.\n * @param {function(string, object): void} trackEventFn - The SDK's trackEvent function.\n * @param {function(string, ...any): void} logFn - The SDK's log function.\n * @param {object} sdkInstance - The SDK instance to access internal properties like _lastTrackedPage.\n */\nexport function initAutomaticPageTracking(trackEventFn, logFn, sdkInstance) {\n  // Initial page view when the SDK is loaded and initialized\n  trackPageView(trackEventFn, logFn, sdkInstance)\n\n  // Override pushState and replaceState to detect programmatic URL changes\n  const originalPushState = history.pushState\n  history.pushState = function (...args) {\n    originalPushState.apply(history, args)\n    trackPageView(trackEventFn, logFn, sdkInstance)\n  }\n\n  const originalReplaceState = history.replaceState\n  history.replaceState = function (...args) {\n    originalReplaceState.apply(history, args)\n    trackPageView(trackEventFn, logFn, sdkInstance)\n  }\n\n  // Listen for browser back/forward button clicks\n  window.addEventListener(\"popstate\", () => {\n    trackPageView(trackEventFn, logFn, sdkInstance)\n  })\n\n  logFn(\"info\", \"Automatic page view tracking listeners attached.\")\n}\n\n/**\n * Tracks a page view event.\n * Prevents duplicate tracking if the URL hasn't actually changed.\n * @private\n * @param {function(string, object): void} trackEventFn - The SDK's trackEvent function.\n * @param {function(string, ...any): void} logFn - The SDK's log function.\n * @param {object} sdkInstance - The SDK instance to access internal properties like _lastTrackedPage.\n */\nfunction trackPageView(trackEventFn, logFn, sdkInstance) {\n  const currentPage = window.location.pathname + window.location.search\n  // Only track if the page URL has actually changed from the last tracked one\n  if (sdkInstance._lastTrackedPage === currentPage) {\n    logFn(\"debug\", \"Page URL unchanged, skipping duplicate page view tracking.\")\n    return\n  }\n  sdkInstance._lastTrackedPage = currentPage // Update the last tracked page\n\n  trackEventFn(\"Page Viewed\", {\n    pageTitle: document.title,\n    path: window.location.pathname,\n    query: window.location.search,\n    fullUrl: window.location.href,\n  }).catch((e) => logFn(\"error\", \"Error tracking automatic page view:\", e))\n}\n","// adtivity-sdk/src/utils/storage.js\n\nconst ANONYMOUS_ID_KEY = \"adtivity_anonymous_id\"\nconst SESSION_ID_KEY = \"adtivity_session_id\"\n\n/**\n * Safely sets an item in localStorage.\n * Handles potential SecurityError if localStorage is unavailable (e.g., some sandboxed iframes).\n * @param {string} key - The key to store the data under.\n * @param {string} value - The string value to store.\n */\nexport function setLocalStorageItem(key, value) {\n  try {\n    localStorage.setItem(key, value)\n  } catch (e) {\n    console.warn(`[Adtivity SDK] Failed to set localStorage item '${key}':`, e)\n  }\n}\n\n/**\n * Safely gets an item from localStorage.\n * Handles potential errors.\n * @param {string} key - The key of the item to retrieve.\n * @returns {string|null} The stored value, or null if not found or an error occurred.\n */\nexport function getLocalStorageItem(key) {\n  try {\n    return localStorage.getItem(key)\n  } catch (e) {\n    console.warn(`[Adtivity SDK] Failed to get localStorage item '${key}':`, e)\n    return null\n  }\n}\n\n/**\n * Safely removes an item from localStorage.\n * Handles potential errors.\n * @param {string} key - The key of the item to remove.\n */\nexport function removeLocalStorageItem(key) {\n  try {\n    localStorage.removeItem(key)\n  } catch (e) {\n    console.warn(\n      `[Adtivity SDK] Failed to remove localStorage item '${key}':`,\n      e\n    )\n  }\n}\n\n/**\n * Generates or retrieves a unique anonymous ID from local storage.\n * @param {function(string, ...any): void} logger - The SDK's log function.\n * @returns {string} The anonymous ID.\n */\nexport function getAnonymousId(logger) {\n  let anonymousId = getLocalStorageItem(ANONYMOUS_ID_KEY)\n  if (!anonymousId) {\n    // Generate a simple UUID-like string\n    anonymousId =\n      \"anon_\" +\n      Math.random().toString(36).substring(2, 15) +\n      Math.random().toString(36).substring(2, 15)\n    setLocalStorageItem(ANONYMOUS_ID_KEY, anonymousId)\n    logger(\"debug\", \"Generated new anonymous ID:\", anonymousId)\n  }\n  return anonymousId\n}\n\n/**\n * Generates or retrieves a unique session ID from session storage.\n * This ID is typically valid for the duration of the browser tab/session.\n * @param {function(string, ...any): void} logger - The SDK's log function.\n * @returns {string} The session ID.\n */\nexport function getSessionId(logger) {\n  let sessionId = sessionStorage.getItem(SESSION_ID_KEY)\n  if (!sessionId) {\n    // Generate a simple session ID based on timestamp and random string\n    sessionId =\n      \"sess_\" + Date.now() + \"_\" + Math.random().toString(36).substring(2, 8)\n    sessionStorage.setItem(SESSION_ID_KEY, sessionId)\n    logger(\"debug\", \"Generated new session ID:\", sessionId)\n  }\n  return sessionId\n}\n","// adtivity-sdk/src/index.js\n\nimport { initAutomaticClickTracking } from \"./autoTrackers/clickTracker\"\nimport { initAutomaticPageTracking } from \"./autoTrackers/pageTracker\"\nimport {\n  getLocalStorageItem,\n  removeLocalStorageItem,\n  setLocalStorageItem,\n} from \"./utils/storage\"\n\n/**\n * Adtivity SDK for Web Applications\n * Provides methods to track events, identify users, and manages data collection\n * with batching, retries, and persistence.\n */\nclass Adtivity {\n  /**\n   * SDK configuration.\n   * @private\n   * @type {object}\n   */\n  _config = {\n    // Changed from #config to _config\n    apiKey: null,\n    apiBaseUrl: \"https://api.adtivity.com/v1\", // REPLACE WITH YOUR ACTUAL ADTIVITY API BASE URL\n    debug: false,\n    // Batching configuration\n    batchSize: 10, // Max events per batch\n    flushInterval: 5000, // Flush events every 5 seconds (ms)\n    // Retry configuration\n    maxRetries: 3,\n    retryDelayMs: 1000, // Initial delay for exponential backoff\n    // Consent\n    // Default to true. Developers should set this based on user consent (e.g., from a CMP).\n    collectData: true,\n  }\n\n  /**\n   * Internal queue for events to be sent.\n   * @private\n   * @type {Array<object>}\n   */\n  _eventQueue = [] // Changed from #eventQueue to _eventQueue\n\n  /**\n   * Timer for flushing events.\n   * @private\n   * @type {number|null}\n   */\n  _flushTimer = null // Changed from #flushTimer to _flushTimer\n\n  /**\n   * Internal flag to check if the SDK has been initialized.\n   * @private\n   * @type {boolean}\n   */\n  static _isInitialized = false // Changed from #isInitialized to _isInitialized\n\n  /**\n   * Stores the singleton instance of the SDK.\n   * @private\n   * @type {Adtivity|null}\n   */\n  static _instance = null // Changed from #instance to _instance\n\n  /**\n   * Queue for calls made before the SDK is fully initialized.\n   * This allows developers to call SDK methods immediately, even if the script hasn't fully loaded.\n   * @private\n   * @type {Array<Array<any>>}\n   */\n  static _deferredCalls = [] // Changed from #deferredCalls to _deferredCalls\n\n  /**\n   * Stores the last tracked page path to prevent duplicate page view events in SPAs.\n   * @private\n   * @type {string|null}\n   */\n  _lastTrackedPage = null // Accessible by pageTracker.js\n\n  /**\n   * Creates an instance of the Adtivity SDK.\n   * This constructor should ideally be called once during the application's lifecycle.\n   * Use `Adtivity.getInstance(options)` for proper singleton management.\n   * @param {object} options - Configuration options for the SDK.\n   * @param {string} options.apiKey - Your unique API key for authentication. (Required)\n   * @param {string} [options.apiBaseUrl='https://api.adtivity.com/v1'] - Base URL for your API.\n   * @param {boolean} [options.debug=false] - Enable debug logging to the console.\n   * @param {number} [options.batchSize=10] - Maximum number of events to batch before sending.\n   * @param {number} [options.flushInterval=5000] - Time in ms to wait before flushing events, even if batchSize is not met.\n   * @param {number} [options.maxRetries=3] - Maximum number of retries for failed network requests.\n   * @param {number} [options.retryDelayMs=1000] - Initial delay in milliseconds for exponential backoff retries.\n   * @param {boolean} [options.collectData=true] - Set to false to disable all data collection.\n   */\n  constructor(options) {\n    if (Adtivity._isInitialized) {\n      // Changed from #isInitialized to _isInitialized\n      this._log(\n        // Changed from #log to _log\n        \"warn\",\n        \"Adtivity SDK already initialized. Subsequent initializations will be ignored.\"\n      )\n      return\n    }\n\n    if (!options || !options.apiKey) {\n      console.error(\n        \"Adtivity SDK Error: API Key is required for initialization.\"\n      )\n      return\n    }\n\n    this._config = { ...this._config, ...options } // Changed from #config to _config\n    Adtivity._isInitialized = true // Changed from #isInitialized to _isInitialized\n    this._log(\"info\", \"Adtivity SDK initialized successfully.\", this._config) // Changed from #log to _log, #config to _config\n\n    // Load persisted events from local storage (if any)\n    this._loadPersistedEvents() // Changed from #loadPersistedEvents to _loadPersistedEvents\n\n    // Start the periodic flush timer\n    this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n\n    // Process any deferred calls that occurred before initialization\n    this._processDeferredCalls() // Changed from #processDeferredCalls to _processDeferredCalls\n\n    // Add event listener for page unload to ensure events are sent\n    // Using `visibilitychange` for better cross-browser support and reliability\n    document.addEventListener(\"visibilitychange\", () => {\n      if (document.visibilityState === \"hidden\") {\n        this.flushEvents(true) // Flush when page becomes hidden\n      }\n    })\n    // Fallback for older browsers or specific scenarios\n    window.addEventListener(\"beforeunload\", () => this.flushEvents(true))\n    window.addEventListener(\"unload\", () => this.flushEvents(true))\n  }\n\n  /**\n   * Gets the singleton instance of the Adtivity SDK.\n   * If the SDK has not been initialized, it initializes it with the provided options.\n   * Subsequent calls with options will ignore the options if already initialized.\n   * @param {object} [options] - Configuration options. Only used for the first initialization.\n   * @returns {Adtivity} The SDK instance.\n   */\n  static getInstance(options) {\n    if (!Adtivity._instance) {\n      // Changed from #instance to _instance\n      Adtivity._instance = new Adtivity(options) // Changed from #instance to _instance\n    }\n    return Adtivity._instance // Changed from #instance to _instance\n  }\n\n  /**\n   * Internal logging utility.\n   * @private\n   * @param {'info'|'warn'|'error'|'debug'} level - Log level.\n   * @param {...any} args - Arguments to log.\n   */\n  _log(level, ...args) {\n    // Changed from #log to _log\n    if (this._config.debug || level === \"error\" || level === \"warn\") {\n      // Changed from #config to _config\n      console[level](`[Adtivity SDK]`, ...args)\n    }\n  }\n\n  /**\n   * Stores events in local storage for persistence.\n   * @private\n   */\n  _persistEvents() {\n    // Changed from #persistEvents to _persistEvents\n    try {\n      setLocalStorageItem(\n        \"adtivity_event_queue\",\n        JSON.stringify(this._eventQueue) // Changed from #eventQueue to _eventQueue\n      )\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `Persisted ${this._eventQueue.length} events to local storage.` // Changed from #eventQueue to _eventQueue\n      )\n    } catch (e) {\n      this._log(\"error\", \"Failed to persist events to local storage:\", e) // Changed from #log to _log\n    }\n  }\n\n  /**\n   * Loads events from local storage into the queue.\n   * @private\n   */\n  _loadPersistedEvents() {\n    // Changed from #loadPersistedEvents to _loadPersistedEvents\n    try {\n      const persistedQueue = getLocalStorageItem(\"adtivity_event_queue\")\n      if (persistedQueue) {\n        this._eventQueue = JSON.parse(persistedQueue) // Changed from #eventQueue to _eventQueue\n        this._log(\n          // Changed from #log to _log\n          \"info\",\n          `Loaded ${this._eventQueue.length} events from local storage.` // Changed from #eventQueue to _eventQueue\n        )\n        removeLocalStorageItem(\"adtivity_event_queue\") // Clear after loading\n      }\n    } catch (e) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        \"Failed to load persisted events from local storage:\",\n        e\n      )\n      removeLocalStorageItem(\"adtivity_event_queue\") // Clear corrupted data\n    }\n  }\n\n  /**\n   * Starts the periodic timer to flush events.\n   * @private\n   */\n  _startFlushTimer() {\n    // Changed from #startFlushTimer to _startFlushTimer\n    if (this._flushTimer) {\n      // Changed from #flushTimer to _flushTimer\n      clearInterval(this._flushTimer) // Changed from #flushTimer to _flushTimer\n    }\n    this._flushTimer = window.setInterval(() => {\n      // Changed from #flushTimer to _flushTimer\n      if (this._eventQueue.length > 0) {\n        // Changed from #eventQueue to _eventQueue\n        this._log(\"debug\", \"Flushing events due to interval.\") // Changed from #log to _log\n        this.flushEvents()\n      }\n    }, this._config.flushInterval) // Changed from #config to _config\n    this._log(\n      // Changed from #log to _log\n      \"debug\",\n      `Flush timer started for every ${this._config.flushInterval}ms.` // Changed from #config to _config\n    )\n  }\n\n  /**\n   * Sends the current batch of events to your API.\n   * @private\n   * @param {Array<object>} eventsToSend - The array of events to send.\n   * @param {number} retryCount - Current retry attempt count.\n   * @returns {Promise<any>} - Promise that resolves with the API response.\n   */\n  async _sendBatch(eventsToSend, retryCount = 0) {\n    // Changed from #sendBatch to _sendBatch\n    if (!this._config.apiKey) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        \"API Key is missing. Please ensure SDK is initialized with a valid API Key.\"\n      )\n      return Promise.reject(new Error(\"API Key missing\"))\n    }\n\n    const url = `${this._config.apiBaseUrl}/events` // Changed from #config to _config\n    try {\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `Sending batch of ${eventsToSend.length} events. Attempt ${\n          retryCount + 1\n        }.`,\n        eventsToSend\n      )\n      const response = await fetch(url, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${this._config.apiKey}`, // Changed from #config to _config\n        },\n        body: JSON.stringify(eventsToSend),\n        // Keepalive is crucial for unload events to complete\n        keepalive: true,\n      })\n\n      if (!response.ok) {\n        const errorData = await response\n          .json()\n          .catch(() => ({ message: \"Unknown error\" }))\n        throw new Error(\n          `API Error (${response.status}): ${response.statusText} - ${\n            errorData.message || JSON.stringify(errorData)\n          }`\n        )\n      }\n\n      this._log(\n        // Changed from #log to _log\n        \"info\",\n        `Successfully sent batch of ${eventsToSend.length} events.`\n      )\n      return response.json()\n    } catch (error) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        `Failed to send batch (Attempt ${retryCount + 1}):`,\n        error\n      )\n\n      if (retryCount < this._config.maxRetries) {\n        // Changed from #config to _config\n        const delay = this._config.retryDelayMs * Math.pow(2, retryCount) // Changed from #config to _config\n        this._log(\"info\", `Retrying in ${delay}ms...`) // Changed from #log to _log\n        await new Promise((resolve) => setTimeout(resolve, delay))\n        return this._sendBatch(eventsToSend, retryCount + 1) // Changed from #sendBatch to _sendBatch\n      } else {\n        this._log(\n          // Changed from #log to _log\n          \"error\",\n          \"Max retries reached. Dropping batch or re-queueing (not implemented for simplicity).\"\n        )\n        // In a real SDK, you might re-queue these to local storage or a dead-letter queue.\n        throw error // Re-throw if the calling code needs to know about the final failure\n      }\n    }\n  }\n\n  /**\n   * Adds an event to the queue and flushes if batch size is met.\n   * @private\n   * @param {object} eventPayload - The event object to queue.\n   * @returns {void}\n   */\n  _queueEvent(eventPayload) {\n    // Changed from #queueEvent to _queueEvent\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\"debug\", \"Data collection disabled. Event not queued.\") // Changed from #log to _log\n      return\n    }\n\n    this._eventQueue.push(eventPayload) // Changed from #eventQueue to _eventQueue\n    this._log(\n      // Changed from #log to _log\n      \"debug\",\n      `Event queued. Queue size: ${this._eventQueue.length}.`, // Changed from #eventQueue to _eventQueue\n      eventPayload\n    )\n\n    if (this._eventQueue.length >= this._config.batchSize) {\n      // Changed from #eventQueue to _eventQueue, #config to _config\n      this._log(\"debug\", \"Batch size met. Flushing events.\") // Changed from #log to _log\n      this.flushEvents()\n    } else {\n      // Restart timer to ensure flush interval is respected from last event addition\n      this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n    }\n    this._persistEvents() // Changed from #persistEvents to _persistEvents\n  }\n\n  /**\n   * Flushes all queued events immediately.\n   * This method attempts to send all events currently in the queue.\n   * @param {boolean} [isUnload=false] - True if called during page unload. This affects error handling behavior.\n   * @returns {Promise<void>}\n   */\n  async flushEvents(isUnload = false) {\n    if (this._eventQueue.length === 0) {\n      // Changed from #eventQueue to _eventQueue\n      this._log(\"debug\", \"No events to flush.\") // Changed from #log to _log\n      return\n    }\n\n    // Clear existing timer as we're flushing now\n    if (this._flushTimer) {\n      // Changed from #flushTimer to _flushTimer\n      clearInterval(this._flushTimer) // Changed from #flushTimer to _flushTimer\n      this._flushTimer = null // Changed from #flushTimer to _flushTimer\n    }\n\n    const eventsToFlush = [...this._eventQueue] // Changed from #eventQueue to _eventQueue\n    this._eventQueue = [] // Changed from #eventQueue to _eventQueue\n\n    try {\n      await this._sendBatch(eventsToFlush) // Changed from #sendBatch to _sendBatch\n      removeLocalStorageItem(\"adtivity_event_queue\") // Clear persisted queue after successful send\n    } catch (error) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        \"Error flushing events. Events might be re-queued or lost.\",\n        error\n      )\n      // If flushing failed, you might want to put events back in queue\n      // or handle them based on 'isUnload'\n      if (!isUnload) {\n        // If not unload, re-queue for next attempt\n        this._eventQueue.unshift(...eventsToFlush) // Changed from #eventQueue to _eventQueue\n        this._persistEvents() // Changed from #persistEvents to _persistEvents\n      } else {\n        // During unload, dropping is often preferred over blocking the page too long\n        this._log(\n          // Changed from #log to _log\n          \"warn\",\n          \"Events likely lost during unload due to send failure:\",\n          eventsToFlush\n        )\n      }\n    } finally {\n      // Restart timer if not during unload and there are still events in queue\n      if (!isUnload && this._eventQueue.length > 0) {\n        // Changed from #eventQueue to _eventQueue\n        this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n      }\n    }\n  }\n\n  /**\n   * Tracks a custom event.\n   * Events are queued and sent in batches.\n   * @param {string} eventName - The name of the event (e.g., 'Product Viewed', 'AddToCart').\n   * @param {object} [properties={}] - Optional properties associated with the event.\n   * @returns {void} (Note: This is now just adding to queue, not sending immediately)\n   */\n  trackEvent(eventName, properties = {}) {\n    if (!Adtivity._isInitialized) {\n      // Changed from #isInitialized to _isInitialized\n      this._log(\"warn\", \"SDK not initialized. Deferring event:\", eventName) // Changed from #log to _log\n      Adtivity._deferredCalls.push([\"trackEvent\", eventName, properties]) // Changed from #deferredCalls to _deferredCalls\n      return\n    }\n\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `Event '${eventName}' not tracked due to consent settings.`\n      )\n      return\n    }\n\n    const payload = {\n      eventName,\n      properties: {\n        ...properties,\n        timestamp: new Date().toISOString(),\n        url: window.location.href,\n        referrer: document.referrer,\n        userAgent: navigator.userAgent,\n        sessionId: this._getSessionId(), // Changed from #getSessionId to _getSessionId\n        anonymousId: this._getAnonymousId(), // Changed from #getAnonymousId to _getAnonymousId\n      },\n    }\n    this._queueEvent(payload) // Changed from #queueEvent to _queueEvent\n  }\n\n  /**\n   * Identifies a user with unique ID and properties.\n   * This will immediately trigger a dedicated send for the identify event.\n   * @param {string} userId - A unique identifier for the user (e.g., database ID, wallet address).\n   * @param {object} [properties={}] - Optional properties of the user (e.g., name, email, wallet type).\n   * @returns {Promise<void>}\n   */\n  async identify(userId, properties = {}) {\n    if (!Adtivity._isInitialized) {\n      // Changed from #isInitialized to _isInitialized\n      this._log(\"warn\", \"SDK not initialized. Deferring identify call:\", userId) // Changed from #log to _log\n      Adtivity._deferredCalls.push([\"identify\", userId, properties]) // Changed from #deferredCalls to _deferredCalls\n      return\n    }\n\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `User identification for '${userId}' skipped due to consent settings.`\n      )\n      return\n    }\n\n    if (!userId) {\n      this._log(\"error\", \"User ID is required for identification.\") // Changed from #log to _log\n      return\n    }\n\n    const payload = {\n      userId,\n      properties: {\n        ...properties,\n        lastSeen: new Date().toISOString(),\n      },\n    }\n    // Identify calls are often sent immediately or in a dedicated queue\n    // For simplicity, we'll send it directly and ensure anonymousId is linked\n    try {\n      const identifyPayload = {\n        type: \"identify\", // Special type for identify\n        anonymousId: this._getAnonymousId(), // Changed from #getAnonymousId to _getAnonymousId\n        userId: userId,\n        properties: payload.properties,\n        timestamp: new Date().toISOString(),\n      }\n      // Send identify as a single-event batch immediately\n      await this._sendBatch([identifyPayload]) // Changed from #sendBatch to _sendBatch\n    } catch (error) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        `Failed to send identify call for user ${userId}:`,\n        error\n      )\n    }\n  }\n\n  /**\n   * Sets or updates the consent status for data collection.\n   * If consent is revoked, any pending events are flushed, and further collection stops.\n   * If consent is given, collection resumes.\n   * @param {boolean} consentGiven - True if user has given consent, false otherwise.\n   */\n  setConsent(consentGiven) {\n    this._config.collectData = consentGiven // Changed from #config to _config\n    this._log(\n      // Changed from #log to _log\n      \"info\",\n      `Adtivity SDK data collection consent set to: ${consentGiven}`\n    )\n    if (!consentGiven) {\n      this.flushEvents() // Try to send any remaining events before stopping\n      this._eventQueue = [] // Changed from #eventQueue to _eventQueue\n      removeLocalStorageItem(\"adtivity_event_queue\") // Clear persisted queue\n      if (this._flushTimer) {\n        // Changed from #flushTimer to _flushTimer\n        clearInterval(this._flushTimer) // Changed from #flushTimer to _flushTimer\n        this._flushTimer = null // Changed from #flushTimer to _flushTimer\n      }\n      this._log(\"info\", \"All data collection stopped and cleared.\") // Changed from #log to _log\n    } else {\n      this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n      this._loadPersistedEvents() // Changed from #loadPersistedEvents to _loadPersistedEvents\n    }\n  }\n\n  /**\n   * Processes events that were deferred before the SDK was initialized.\n   * @private\n   */\n  _processDeferredCalls() {\n    // Changed from #processDeferredCalls to _processDeferredCalls\n    if (Adtivity._deferredCalls.length > 0) {\n      // Changed from #deferredCalls to _deferredCalls\n      this._log(\n        // Changed from #log to _log\n        \"info\",\n        `Processing ${Adtivity._deferredCalls.length} deferred calls.` // Changed from #deferredCalls to _deferredCalls\n      )\n      while (Adtivity._deferredCalls.length > 0) {\n        // Changed from #deferredCalls to _deferredCalls\n        const [methodName, ...args] = Adtivity._deferredCalls.shift() // Changed from #deferredCalls to _deferredCalls\n        // Ensure the method exists on the instance before calling\n        if (typeof this[methodName] === \"function\") {\n          this[methodName](...args) // Call the actual method\n        } else {\n          this._log(\"warn\", `Deferred call to unknown method: ${methodName}`) // Changed from #log to _log\n        }\n      }\n    }\n  }\n\n  /**\n   * Initializes automatic page view tracking for SPAs.\n   * This should be called after SDK initialization if desired.\n   */\n  initAutomaticPageTracking() {\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        \"Automatic page tracking skipped due to consent settings.\"\n      )\n      return\n    }\n    // Pass the SDK's trackEvent method, log method, and instance for internal state\n    initAutomaticPageTracking(\n      (eventName, props) => this.trackEvent(eventName, props),\n      this._log, // Changed from #log to _log\n      this // Pass the Adtivity instance itself\n    )\n    this._log(\"info\", \"Automatic page view tracking initialized.\") // Changed from #log to _log\n  }\n\n  /**\n   * Initializes automatic click tracking for elements with `data-adtivity-track` attribute.\n   */\n  initAutomaticClickTracking() {\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        \"Automatic click tracking skipped due to consent settings.\"\n      )\n      return\n    }\n    // Pass the SDK's trackEvent method and log method\n    initAutomaticClickTracking(\n      (eventName, props) => this.trackEvent(eventName, props),\n      this._log // Changed from #log to _log\n    )\n    this._log(\"info\", \"Automatic click tracking initialized.\") // Changed from #log to _log\n  }\n\n  // Add this for Jest testing to reset private static fields\n  static __resetForTesting() {\n    Adtivity._isInitialized = false\n    Adtivity._instance = null\n    Adtivity._deferredCalls = []\n  }\n}\n\n// Global accessor for deferred calls before SDK is fully loaded\n// This allows developers to call `window.Adtivity.trackEvent` even if the script hasn't fully loaded/initialized.\nwindow.Adtivity = window.Adtivity || {\n  // These methods will simply push their arguments to a queue\n  // which the actual SDK instance will process upon initialization.\n  trackEvent: (...args) =>\n    Adtivity._deferredCalls.push([\"trackEvent\", ...args]), // Changed from #deferredCalls to _deferredCalls\n  identify: (...args) => Adtivity._deferredCalls.push([\"identify\", ...args]), // Changed from #deferredCalls to _deferredCalls\n  setConsent: (...args) =>\n    Adtivity._deferredCalls.push([\"setConsent\", ...args]), // Changed from #deferredCalls to _deferredCalls\n  // Allow direct access to get instance for advanced configuration\n  getInstance: (options) => Adtivity.getInstance(options),\n}\n\n// --- Initial setup on DOMContentLoaded (Recommended for most cases) ---\n// This ensures the SDK is initialized once the DOM is ready.\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  // Initialize the Adtivity SDK. Developers will provide their API key here.\n  // `window.adtivityConfig` is a global object developers can define on their page.\n  const adtivityInstance = window.Adtivity.getInstance(\n    window.adtivityConfig || {\n      apiKey: \"YOUR_DEFAULT_OR_FALLBACK_API_KEY\", // Fallback for quick testing\n      debug: true, // Enable debug logging for development\n    }\n  )\n\n  // Automatically initialize common tracking features\n  adtivityInstance.initAutomaticPageTracking()\n  adtivityInstance.initAutomaticClickTracking()\n})\n\n// Fallback for scripts loaded after DOMContentLoaded (e.g., dynamic script injection)\n// This ensures the SDK is initialized if it wasn't by DOMContentLoaded.\nif (document.readyState === \"complete\" && !Adtivity._isInitialized) {\n  // Changed from #isInitialized to _isInitialized\n  window.Adtivity.getInstance(\n    window.adtivityConfig || {\n      apiKey: \"YOUR_DEFAULT_OR_FALLBACK_API_KEY\",\n      debug: true,\n    }\n  )\n}\n\n// Export the Adtivity class for module environments (NPM packages)\nexport { Adtivity }\n","// adtivity-sdk/src/autoTrackers/clickTracker.js\n\n/**\n * Initializes automatic click tracking for elements with `data-adtivity-track` attribute.\n * Attaches a global click listener to the document body.\n * @param {function(string, object): void} trackEventFn - The SDK's trackEvent function.\n * @param {function(string, ...any): void} logFn - The SDK's log function.\n */\nexport function initAutomaticClickTracking(trackEventFn, logFn) {\n  document.body.addEventListener(\"click\", (event) => {\n    // Use .closest() to find the nearest ancestor with the data-adtivity-track attribute\n    const target = event.target.closest(\"[data-adtivity-track]\")\n    if (target) {\n      const eventName =\n        target.getAttribute(\"data-adtivity-track\") || \"Automatic Click\"\n      let properties = {\n        elementId: target.id || null,\n        // Capture innerText, but limit length to avoid excessively large payloads\n        elementText: target.innerText\n          ? target.innerText.substring(0, 200)\n          : null,\n        elementType: target.tagName,\n        // Capture common attributes for context\n        href: target.href || null, // For <a> tags\n        type: target.type || null, // For <input> tags\n        value: target.value || null, // For <input> tags\n        className: target.className || null, // Capture CSS classes\n      }\n\n      // Attempt to parse additional properties from a data-adtivity-props attribute\n      // This allows developers to pass custom JSON data with the click event\n      if (target.dataset.adtivityProps) {\n        try {\n          const customProps = JSON.parse(target.dataset.adtivityProps)\n          properties = { ...properties, ...customProps }\n        } catch (e) {\n          logFn(\n            \"error\",\n            \"Failed to parse data-adtivity-props. Ensure it is valid JSON:\",\n            e,\n            target.dataset.adtivityProps\n          )\n        }\n      }\n\n      trackEventFn(eventName, properties).catch((e) =>\n        logFn(\"error\", \"Error tracking automatic click:\", e)\n      )\n    }\n  })\n  logFn(\"info\", \"Automatic click tracking listeners attached.\")\n}\n"],"names":["trackPageView","trackEventFn","logFn","sdkInstance","currentPage","window","location","pathname","search","_lastTrackedPage","pageTitle","document","title","path","query","fullUrl","href","catch","e","removeLocalStorageItem","key","localStorage","removeItem","console","warn","Adtivity","constructor","options","this","_config","apiKey","apiBaseUrl","debug","batchSize","flushInterval","maxRetries","retryDelayMs","collectData","_eventQueue","_flushTimer","_isInitialized","_log","_loadPersistedEvents","_startFlushTimer","_processDeferredCalls","addEventListener","visibilityState","flushEvents","error","getInstance","_instance","level","_len","arguments","length","args","Array","_key","_persistEvents","value","setItem","setLocalStorageItem","JSON","stringify","persistedQueue","getItem","getLocalStorageItem","parse","clearInterval","setInterval","_sendBatch","eventsToSend","retryCount","undefined","Promise","reject","Error","url","response","fetch","method","headers","Authorization","body","keepalive","ok","errorData","json","message","status","statusText","delay","Math","pow","resolve","setTimeout","_queueEvent","eventPayload","push","isUnload","eventsToFlush","unshift","trackEvent","eventName","properties","_deferredCalls","payload","timestamp","Date","toISOString","referrer","userAgent","navigator","sessionId","_getSessionId","anonymousId","_getAnonymousId","identify","userId","lastSeen","identifyPayload","type","setConsent","consentGiven","methodName","shift","initAutomaticPageTracking","originalPushState","history","pushState","apply","originalReplaceState","replaceState","_len2","_key2","props","initAutomaticClickTracking","event","target","closest","getAttribute","elementId","id","elementText","innerText","substring","elementType","tagName","className","dataset","adtivityProps","customProps","__resetForTesting","_len3","_key3","_len4","_key4","adtivityInstance","adtivityConfig","readyState"],"mappings":"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"}