{"version":3,"file":"adtivity-sdk.esm.js","sources":["../src/autoTrackers/clickTracker.js","../src/autoTrackers/pageTracker.js","../src/utils/storage.js","../src/index.js"],"sourcesContent":["// adtivity-sdk/src/autoTrackers/clickTracker.js\n\n/**\n * Initializes automatic click tracking for elements with `data-adtivity-track` attribute.\n * Attaches a global click listener to the document body.\n * @param {function(string, object): void} trackEventFn - The SDK's trackEvent function.\n * @param {function(string, ...any): void} logFn - The SDK's log function.\n */\nexport function initAutomaticClickTracking(trackEventFn, logFn) {\n  document.body.addEventListener(\"click\", (event) => {\n    // Use .closest() to find the nearest ancestor with the data-adtivity-track attribute\n    const target = event.target.closest(\"[data-adtivity-track]\")\n    if (target) {\n      const eventName =\n        target.getAttribute(\"data-adtivity-track\") || \"Automatic Click\"\n      let properties = {\n        elementId: target.id || null,\n        // Capture innerText, but limit length to avoid excessively large payloads\n        elementText: target.innerText\n          ? target.innerText.substring(0, 200)\n          : null,\n        elementType: target.tagName,\n        // Capture common attributes for context\n        href: target.href || null, // For <a> tags\n        type: target.type || null, // For <input> tags\n        value: target.value || null, // For <input> tags\n        className: target.className || null, // Capture CSS classes\n      }\n\n      // Attempt to parse additional properties from a data-adtivity-props attribute\n      // This allows developers to pass custom JSON data with the click event\n      if (target.dataset.adtivityProps) {\n        try {\n          const customProps = JSON.parse(target.dataset.adtivityProps)\n          properties = { ...properties, ...customProps }\n        } catch (e) {\n          logFn(\n            \"error\",\n            \"Failed to parse data-adtivity-props. Ensure it is valid JSON:\",\n            e,\n            target.dataset.adtivityProps\n          )\n        }\n      }\n\n      trackEventFn(eventName, properties).catch((e) =>\n        logFn(\"error\", \"Error tracking automatic click:\", e)\n      )\n    }\n  })\n  logFn(\"info\", \"Automatic click tracking listeners attached.\")\n}\n","// adtivity-sdk/src/autoTrackers/pageTracker.js\n\n/**\n * Initializes automatic page view tracking for Single Page Applications (SPAs).\n * This function hooks into the browser's History API to detect URL changes.\n * @param {function(string, object): void} trackEventFn - The SDK's trackEvent function.\n * @param {function(string, ...any): void} logFn - The SDK's log function.\n * @param {object} sdkInstance - The SDK instance to access internal properties like _lastTrackedPage.\n */\nexport function initAutomaticPageTracking(trackEventFn, logFn, sdkInstance) {\n  // Initial page view when the SDK is loaded and initialized\n  trackPageView(trackEventFn, logFn, sdkInstance)\n\n  // Override pushState and replaceState to detect programmatic URL changes\n  const originalPushState = history.pushState\n  history.pushState = function (...args) {\n    originalPushState.apply(history, args)\n    trackPageView(trackEventFn, logFn, sdkInstance)\n  }\n\n  const originalReplaceState = history.replaceState\n  history.replaceState = function (...args) {\n    originalReplaceState.apply(history, args)\n    trackPageView(trackEventFn, logFn, sdkInstance)\n  }\n\n  // Listen for browser back/forward button clicks\n  window.addEventListener(\"popstate\", () => {\n    trackPageView(trackEventFn, logFn, sdkInstance)\n  })\n\n  logFn(\"info\", \"Automatic page view tracking listeners attached.\")\n}\n\n/**\n * Tracks a page view event.\n * Prevents duplicate tracking if the URL hasn't actually changed.\n * @private\n * @param {function(string, object): void} trackEventFn - The SDK's trackEvent function.\n * @param {function(string, ...any): void} logFn - The SDK's log function.\n * @param {object} sdkInstance - The SDK instance to access internal properties like _lastTrackedPage.\n */\nfunction trackPageView(trackEventFn, logFn, sdkInstance) {\n  const currentPage = window.location.pathname + window.location.search\n  // Only track if the page URL has actually changed from the last tracked one\n  if (sdkInstance._lastTrackedPage === currentPage) {\n    logFn(\"debug\", \"Page URL unchanged, skipping duplicate page view tracking.\")\n    return\n  }\n  sdkInstance._lastTrackedPage = currentPage // Update the last tracked page\n\n  trackEventFn(\"Page Viewed\", {\n    pageTitle: document.title,\n    path: window.location.pathname,\n    query: window.location.search,\n    fullUrl: window.location.href,\n  }).catch((e) => logFn(\"error\", \"Error tracking automatic page view:\", e))\n}\n","// adtivity-sdk/src/utils/storage.js\n\nconst ANONYMOUS_ID_KEY = \"adtivity_anonymous_id\"\nconst SESSION_ID_KEY = \"adtivity_session_id\"\n\n/**\n * Safely sets an item in localStorage.\n * Handles potential SecurityError if localStorage is unavailable (e.g., some sandboxed iframes).\n * @param {string} key - The key to store the data under.\n * @param {string} value - The string value to store.\n */\nexport function setLocalStorageItem(key, value) {\n  try {\n    localStorage.setItem(key, value)\n  } catch (e) {\n    console.warn(`[Adtivity SDK] Failed to set localStorage item '${key}':`, e)\n  }\n}\n\n/**\n * Safely gets an item from localStorage.\n * Handles potential errors.\n * @param {string} key - The key of the item to retrieve.\n * @returns {string|null} The stored value, or null if not found or an error occurred.\n */\nexport function getLocalStorageItem(key) {\n  try {\n    return localStorage.getItem(key)\n  } catch (e) {\n    console.warn(`[Adtivity SDK] Failed to get localStorage item '${key}':`, e)\n    return null\n  }\n}\n\n/**\n * Safely removes an item from localStorage.\n * Handles potential errors.\n * @param {string} key - The key of the item to remove.\n */\nexport function removeLocalStorageItem(key) {\n  try {\n    localStorage.removeItem(key)\n  } catch (e) {\n    console.warn(\n      `[Adtivity SDK] Failed to remove localStorage item '${key}':`,\n      e\n    )\n  }\n}\n\n/**\n * Generates or retrieves a unique anonymous ID from local storage.\n * @param {function(string, ...any): void} logger - The SDK's log function.\n * @returns {string} The anonymous ID.\n */\nexport function getAnonymousId(logger) {\n  let anonymousId = getLocalStorageItem(ANONYMOUS_ID_KEY)\n  if (!anonymousId) {\n    // Generate a simple UUID-like string\n    anonymousId =\n      \"anon_\" +\n      Math.random().toString(36).substring(2, 15) +\n      Math.random().toString(36).substring(2, 15)\n    setLocalStorageItem(ANONYMOUS_ID_KEY, anonymousId)\n    logger(\"debug\", \"Generated new anonymous ID:\", anonymousId)\n  }\n  return anonymousId\n}\n\n/**\n * Generates or retrieves a unique session ID from session storage.\n * This ID is typically valid for the duration of the browser tab/session.\n * @param {function(string, ...any): void} logger - The SDK's log function.\n * @returns {string} The session ID.\n */\nexport function getSessionId(logger) {\n  let sessionId = sessionStorage.getItem(SESSION_ID_KEY)\n  if (!sessionId) {\n    // Generate a simple session ID based on timestamp and random string\n    sessionId =\n      \"sess_\" + Date.now() + \"_\" + Math.random().toString(36).substring(2, 8)\n    sessionStorage.setItem(SESSION_ID_KEY, sessionId)\n    logger(\"debug\", \"Generated new session ID:\", sessionId)\n  }\n  return sessionId\n}\n","// adtivity-sdk/src/index.js\n\nimport { initAutomaticClickTracking } from \"./autoTrackers/clickTracker\"\nimport { initAutomaticPageTracking } from \"./autoTrackers/pageTracker\"\nimport {\n  getLocalStorageItem,\n  removeLocalStorageItem,\n  setLocalStorageItem,\n} from \"./utils/storage\"\n\n/**\n * Adtivity SDK for Web Applications\n * Provides methods to track events, identify users, and manages data collection\n * with batching, retries, and persistence.\n */\nclass Adtivity {\n  /**\n   * SDK configuration.\n   * @private\n   * @type {object}\n   */\n  _config = {\n    // Changed from #config to _config\n    apiKey: null,\n    apiBaseUrl: \"https://api.adtivity.com/v1\", // REPLACE WITH YOUR ACTUAL ADTIVITY API BASE URL\n    debug: false,\n    // Batching configuration\n    batchSize: 10, // Max events per batch\n    flushInterval: 5000, // Flush events every 5 seconds (ms)\n    // Retry configuration\n    maxRetries: 3,\n    retryDelayMs: 1000, // Initial delay for exponential backoff\n    // Consent\n    // Default to true. Developers should set this based on user consent (e.g., from a CMP).\n    collectData: true,\n  }\n\n  /**\n   * Internal queue for events to be sent.\n   * @private\n   * @type {Array<object>}\n   */\n  _eventQueue = [] // Changed from #eventQueue to _eventQueue\n\n  /**\n   * Timer for flushing events.\n   * @private\n   * @type {number|null}\n   */\n  _flushTimer = null // Changed from #flushTimer to _flushTimer\n\n  /**\n   * Internal flag to check if the SDK has been initialized.\n   * @private\n   * @type {boolean}\n   */\n  static _isInitialized = false // Changed from #isInitialized to _isInitialized\n\n  /**\n   * Stores the singleton instance of the SDK.\n   * @private\n   * @type {Adtivity|null}\n   */\n  static _instance = null // Changed from #instance to _instance\n\n  /**\n   * Queue for calls made before the SDK is fully initialized.\n   * This allows developers to call SDK methods immediately, even if the script hasn't fully loaded.\n   * @private\n   * @type {Array<Array<any>>}\n   */\n  static _deferredCalls = [] // Changed from #deferredCalls to _deferredCalls\n\n  /**\n   * Stores the last tracked page path to prevent duplicate page view events in SPAs.\n   * @private\n   * @type {string|null}\n   */\n  _lastTrackedPage = null // Accessible by pageTracker.js\n\n  /**\n   * Creates an instance of the Adtivity SDK.\n   * This constructor should ideally be called once during the application's lifecycle.\n   * Use `Adtivity.getInstance(options)` for proper singleton management.\n   * @param {object} options - Configuration options for the SDK.\n   * @param {string} options.apiKey - Your unique API key for authentication. (Required)\n   * @param {string} [options.apiBaseUrl='https://api.adtivity.com/v1'] - Base URL for your API.\n   * @param {boolean} [options.debug=false] - Enable debug logging to the console.\n   * @param {number} [options.batchSize=10] - Maximum number of events to batch before sending.\n   * @param {number} [options.flushInterval=5000] - Time in ms to wait before flushing events, even if batchSize is not met.\n   * @param {number} [options.maxRetries=3] - Maximum number of retries for failed network requests.\n   * @param {number} [options.retryDelayMs=1000] - Initial delay in milliseconds for exponential backoff retries.\n   * @param {boolean} [options.collectData=true] - Set to false to disable all data collection.\n   */\n  constructor(options) {\n    if (Adtivity._isInitialized) {\n      // Changed from #isInitialized to _isInitialized\n      this._log(\n        // Changed from #log to _log\n        \"warn\",\n        \"Adtivity SDK already initialized. Subsequent initializations will be ignored.\"\n      )\n      return\n    }\n\n    if (!options || !options.apiKey) {\n      console.error(\n        \"Adtivity SDK Error: API Key is required for initialization.\"\n      )\n      return\n    }\n\n    this._config = { ...this._config, ...options } // Changed from #config to _config\n    Adtivity._isInitialized = true // Changed from #isInitialized to _isInitialized\n    this._log(\"info\", \"Adtivity SDK initialized successfully.\", this._config) // Changed from #log to _log, #config to _config\n\n    // Load persisted events from local storage (if any)\n    this._loadPersistedEvents() // Changed from #loadPersistedEvents to _loadPersistedEvents\n\n    // Start the periodic flush timer\n    this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n\n    // Process any deferred calls that occurred before initialization\n    this._processDeferredCalls() // Changed from #processDeferredCalls to _processDeferredCalls\n\n    // Add event listener for page unload to ensure events are sent\n    // Using `visibilitychange` for better cross-browser support and reliability\n    document.addEventListener(\"visibilitychange\", () => {\n      if (document.visibilityState === \"hidden\") {\n        this.flushEvents(true) // Flush when page becomes hidden\n      }\n    })\n    // Fallback for older browsers or specific scenarios\n    window.addEventListener(\"beforeunload\", () => this.flushEvents(true))\n    window.addEventListener(\"unload\", () => this.flushEvents(true))\n  }\n\n  /**\n   * Gets the singleton instance of the Adtivity SDK.\n   * If the SDK has not been initialized, it initializes it with the provided options.\n   * Subsequent calls with options will ignore the options if already initialized.\n   * @param {object} [options] - Configuration options. Only used for the first initialization.\n   * @returns {Adtivity} The SDK instance.\n   */\n  static getInstance(options) {\n    if (!Adtivity._instance) {\n      // Changed from #instance to _instance\n      Adtivity._instance = new Adtivity(options) // Changed from #instance to _instance\n    }\n    return Adtivity._instance // Changed from #instance to _instance\n  }\n\n  /**\n   * Internal logging utility.\n   * @private\n   * @param {'info'|'warn'|'error'|'debug'} level - Log level.\n   * @param {...any} args - Arguments to log.\n   */\n  _log(level, ...args) {\n    // Changed from #log to _log\n    if (this._config.debug || level === \"error\" || level === \"warn\") {\n      // Changed from #config to _config\n      console[level](`[Adtivity SDK]`, ...args)\n    }\n  }\n\n  /**\n   * Stores events in local storage for persistence.\n   * @private\n   */\n  _persistEvents() {\n    // Changed from #persistEvents to _persistEvents\n    try {\n      setLocalStorageItem(\n        \"adtivity_event_queue\",\n        JSON.stringify(this._eventQueue) // Changed from #eventQueue to _eventQueue\n      )\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `Persisted ${this._eventQueue.length} events to local storage.` // Changed from #eventQueue to _eventQueue\n      )\n    } catch (e) {\n      this._log(\"error\", \"Failed to persist events to local storage:\", e) // Changed from #log to _log\n    }\n  }\n\n  /**\n   * Loads events from local storage into the queue.\n   * @private\n   */\n  _loadPersistedEvents() {\n    // Changed from #loadPersistedEvents to _loadPersistedEvents\n    try {\n      const persistedQueue = getLocalStorageItem(\"adtivity_event_queue\")\n      if (persistedQueue) {\n        this._eventQueue = JSON.parse(persistedQueue) // Changed from #eventQueue to _eventQueue\n        this._log(\n          // Changed from #log to _log\n          \"info\",\n          `Loaded ${this._eventQueue.length} events from local storage.` // Changed from #eventQueue to _eventQueue\n        )\n        removeLocalStorageItem(\"adtivity_event_queue\") // Clear after loading\n      }\n    } catch (e) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        \"Failed to load persisted events from local storage:\",\n        e\n      )\n      removeLocalStorageItem(\"adtivity_event_queue\") // Clear corrupted data\n    }\n  }\n\n  /**\n   * Starts the periodic timer to flush events.\n   * @private\n   */\n  _startFlushTimer() {\n    // Changed from #startFlushTimer to _startFlushTimer\n    if (this._flushTimer) {\n      // Changed from #flushTimer to _flushTimer\n      clearInterval(this._flushTimer) // Changed from #flushTimer to _flushTimer\n    }\n    this._flushTimer = window.setInterval(() => {\n      // Changed from #flushTimer to _flushTimer\n      if (this._eventQueue.length > 0) {\n        // Changed from #eventQueue to _eventQueue\n        this._log(\"debug\", \"Flushing events due to interval.\") // Changed from #log to _log\n        this.flushEvents()\n      }\n    }, this._config.flushInterval) // Changed from #config to _config\n    this._log(\n      // Changed from #log to _log\n      \"debug\",\n      `Flush timer started for every ${this._config.flushInterval}ms.` // Changed from #config to _config\n    )\n  }\n\n  /**\n   * Sends the current batch of events to your API.\n   * @private\n   * @param {Array<object>} eventsToSend - The array of events to send.\n   * @param {number} retryCount - Current retry attempt count.\n   * @returns {Promise<any>} - Promise that resolves with the API response.\n   */\n  async _sendBatch(eventsToSend, retryCount = 0) {\n    // Changed from #sendBatch to _sendBatch\n    if (!this._config.apiKey) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        \"API Key is missing. Please ensure SDK is initialized with a valid API Key.\"\n      )\n      return Promise.reject(new Error(\"API Key missing\"))\n    }\n\n    const url = `${this._config.apiBaseUrl}/events` // Changed from #config to _config\n    try {\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `Sending batch of ${eventsToSend.length} events. Attempt ${\n          retryCount + 1\n        }.`,\n        eventsToSend\n      )\n      const response = await fetch(url, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${this._config.apiKey}`, // Changed from #config to _config\n        },\n        body: JSON.stringify(eventsToSend),\n        // Keepalive is crucial for unload events to complete\n        keepalive: true,\n      })\n\n      if (!response.ok) {\n        const errorData = await response\n          .json()\n          .catch(() => ({ message: \"Unknown error\" }))\n        throw new Error(\n          `API Error (${response.status}): ${response.statusText} - ${\n            errorData.message || JSON.stringify(errorData)\n          }`\n        )\n      }\n\n      this._log(\n        // Changed from #log to _log\n        \"info\",\n        `Successfully sent batch of ${eventsToSend.length} events.`\n      )\n      return response.json()\n    } catch (error) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        `Failed to send batch (Attempt ${retryCount + 1}):`,\n        error\n      )\n\n      if (retryCount < this._config.maxRetries) {\n        // Changed from #config to _config\n        const delay = this._config.retryDelayMs * Math.pow(2, retryCount) // Changed from #config to _config\n        this._log(\"info\", `Retrying in ${delay}ms...`) // Changed from #log to _log\n        await new Promise((resolve) => setTimeout(resolve, delay))\n        return this._sendBatch(eventsToSend, retryCount + 1) // Changed from #sendBatch to _sendBatch\n      } else {\n        this._log(\n          // Changed from #log to _log\n          \"error\",\n          \"Max retries reached. Dropping batch or re-queueing (not implemented for simplicity).\"\n        )\n        // In a real SDK, you might re-queue these to local storage or a dead-letter queue.\n        throw error // Re-throw if the calling code needs to know about the final failure\n      }\n    }\n  }\n\n  /**\n   * Adds an event to the queue and flushes if batch size is met.\n   * @private\n   * @param {object} eventPayload - The event object to queue.\n   * @returns {void}\n   */\n  _queueEvent(eventPayload) {\n    // Changed from #queueEvent to _queueEvent\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\"debug\", \"Data collection disabled. Event not queued.\") // Changed from #log to _log\n      return\n    }\n\n    this._eventQueue.push(eventPayload) // Changed from #eventQueue to _eventQueue\n    this._log(\n      // Changed from #log to _log\n      \"debug\",\n      `Event queued. Queue size: ${this._eventQueue.length}.`, // Changed from #eventQueue to _eventQueue\n      eventPayload\n    )\n\n    if (this._eventQueue.length >= this._config.batchSize) {\n      // Changed from #eventQueue to _eventQueue, #config to _config\n      this._log(\"debug\", \"Batch size met. Flushing events.\") // Changed from #log to _log\n      this.flushEvents()\n    } else {\n      // Restart timer to ensure flush interval is respected from last event addition\n      this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n    }\n    this._persistEvents() // Changed from #persistEvents to _persistEvents\n  }\n\n  /**\n   * Flushes all queued events immediately.\n   * This method attempts to send all events currently in the queue.\n   * @param {boolean} [isUnload=false] - True if called during page unload. This affects error handling behavior.\n   * @returns {Promise<void>}\n   */\n  async flushEvents(isUnload = false) {\n    if (this._eventQueue.length === 0) {\n      // Changed from #eventQueue to _eventQueue\n      this._log(\"debug\", \"No events to flush.\") // Changed from #log to _log\n      return\n    }\n\n    // Clear existing timer as we're flushing now\n    if (this._flushTimer) {\n      // Changed from #flushTimer to _flushTimer\n      clearInterval(this._flushTimer) // Changed from #flushTimer to _flushTimer\n      this._flushTimer = null // Changed from #flushTimer to _flushTimer\n    }\n\n    const eventsToFlush = [...this._eventQueue] // Changed from #eventQueue to _eventQueue\n    this._eventQueue = [] // Changed from #eventQueue to _eventQueue\n\n    try {\n      await this._sendBatch(eventsToFlush) // Changed from #sendBatch to _sendBatch\n      removeLocalStorageItem(\"adtivity_event_queue\") // Clear persisted queue after successful send\n    } catch (error) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        \"Error flushing events. Events might be re-queued or lost.\",\n        error\n      )\n      // If flushing failed, you might want to put events back in queue\n      // or handle them based on 'isUnload'\n      if (!isUnload) {\n        // If not unload, re-queue for next attempt\n        this._eventQueue.unshift(...eventsToFlush) // Changed from #eventQueue to _eventQueue\n        this._persistEvents() // Changed from #persistEvents to _persistEvents\n      } else {\n        // During unload, dropping is often preferred over blocking the page too long\n        this._log(\n          // Changed from #log to _log\n          \"warn\",\n          \"Events likely lost during unload due to send failure:\",\n          eventsToFlush\n        )\n      }\n    } finally {\n      // Restart timer if not during unload and there are still events in queue\n      if (!isUnload && this._eventQueue.length > 0) {\n        // Changed from #eventQueue to _eventQueue\n        this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n      }\n    }\n  }\n\n  /**\n   * Tracks a custom event.\n   * Events are queued and sent in batches.\n   * @param {string} eventName - The name of the event (e.g., 'Product Viewed', 'AddToCart').\n   * @param {object} [properties={}] - Optional properties associated with the event.\n   * @returns {void} (Note: This is now just adding to queue, not sending immediately)\n   */\n  trackEvent(eventName, properties = {}) {\n    if (!Adtivity._isInitialized) {\n      // Changed from #isInitialized to _isInitialized\n      this._log(\"warn\", \"SDK not initialized. Deferring event:\", eventName) // Changed from #log to _log\n      Adtivity._deferredCalls.push([\"trackEvent\", eventName, properties]) // Changed from #deferredCalls to _deferredCalls\n      return\n    }\n\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `Event '${eventName}' not tracked due to consent settings.`\n      )\n      return\n    }\n\n    const payload = {\n      eventName,\n      properties: {\n        ...properties,\n        timestamp: new Date().toISOString(),\n        url: window.location.href,\n        referrer: document.referrer,\n        userAgent: navigator.userAgent,\n        sessionId: this._getSessionId(), // Changed from #getSessionId to _getSessionId\n        anonymousId: this._getAnonymousId(), // Changed from #getAnonymousId to _getAnonymousId\n      },\n    }\n    this._queueEvent(payload) // Changed from #queueEvent to _queueEvent\n  }\n\n  /**\n   * Identifies a user with unique ID and properties.\n   * This will immediately trigger a dedicated send for the identify event.\n   * @param {string} userId - A unique identifier for the user (e.g., database ID, wallet address).\n   * @param {object} [properties={}] - Optional properties of the user (e.g., name, email, wallet type).\n   * @returns {Promise<void>}\n   */\n  async identify(userId, properties = {}) {\n    if (!Adtivity._isInitialized) {\n      // Changed from #isInitialized to _isInitialized\n      this._log(\"warn\", \"SDK not initialized. Deferring identify call:\", userId) // Changed from #log to _log\n      Adtivity._deferredCalls.push([\"identify\", userId, properties]) // Changed from #deferredCalls to _deferredCalls\n      return\n    }\n\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        `User identification for '${userId}' skipped due to consent settings.`\n      )\n      return\n    }\n\n    if (!userId) {\n      this._log(\"error\", \"User ID is required for identification.\") // Changed from #log to _log\n      return\n    }\n\n    const payload = {\n      userId,\n      properties: {\n        ...properties,\n        lastSeen: new Date().toISOString(),\n      },\n    }\n    // Identify calls are often sent immediately or in a dedicated queue\n    // For simplicity, we'll send it directly and ensure anonymousId is linked\n    try {\n      const identifyPayload = {\n        type: \"identify\", // Special type for identify\n        anonymousId: this._getAnonymousId(), // Changed from #getAnonymousId to _getAnonymousId\n        userId: userId,\n        properties: payload.properties,\n        timestamp: new Date().toISOString(),\n      }\n      // Send identify as a single-event batch immediately\n      await this._sendBatch([identifyPayload]) // Changed from #sendBatch to _sendBatch\n    } catch (error) {\n      this._log(\n        // Changed from #log to _log\n        \"error\",\n        `Failed to send identify call for user ${userId}:`,\n        error\n      )\n    }\n  }\n\n  /**\n   * Sets or updates the consent status for data collection.\n   * If consent is revoked, any pending events are flushed, and further collection stops.\n   * If consent is given, collection resumes.\n   * @param {boolean} consentGiven - True if user has given consent, false otherwise.\n   */\n  setConsent(consentGiven) {\n    this._config.collectData = consentGiven // Changed from #config to _config\n    this._log(\n      // Changed from #log to _log\n      \"info\",\n      `Adtivity SDK data collection consent set to: ${consentGiven}`\n    )\n    if (!consentGiven) {\n      this.flushEvents() // Try to send any remaining events before stopping\n      this._eventQueue = [] // Changed from #eventQueue to _eventQueue\n      removeLocalStorageItem(\"adtivity_event_queue\") // Clear persisted queue\n      if (this._flushTimer) {\n        // Changed from #flushTimer to _flushTimer\n        clearInterval(this._flushTimer) // Changed from #flushTimer to _flushTimer\n        this._flushTimer = null // Changed from #flushTimer to _flushTimer\n      }\n      this._log(\"info\", \"All data collection stopped and cleared.\") // Changed from #log to _log\n    } else {\n      this._startFlushTimer() // Changed from #startFlushTimer to _startFlushTimer\n      this._loadPersistedEvents() // Changed from #loadPersistedEvents to _loadPersistedEvents\n    }\n  }\n\n  /**\n   * Processes events that were deferred before the SDK was initialized.\n   * @private\n   */\n  _processDeferredCalls() {\n    // Changed from #processDeferredCalls to _processDeferredCalls\n    if (Adtivity._deferredCalls.length > 0) {\n      // Changed from #deferredCalls to _deferredCalls\n      this._log(\n        // Changed from #log to _log\n        \"info\",\n        `Processing ${Adtivity._deferredCalls.length} deferred calls.` // Changed from #deferredCalls to _deferredCalls\n      )\n      while (Adtivity._deferredCalls.length > 0) {\n        // Changed from #deferredCalls to _deferredCalls\n        const [methodName, ...args] = Adtivity._deferredCalls.shift() // Changed from #deferredCalls to _deferredCalls\n        // Ensure the method exists on the instance before calling\n        if (typeof this[methodName] === \"function\") {\n          this[methodName](...args) // Call the actual method\n        } else {\n          this._log(\"warn\", `Deferred call to unknown method: ${methodName}`) // Changed from #log to _log\n        }\n      }\n    }\n  }\n\n  /**\n   * Initializes automatic page view tracking for SPAs.\n   * This should be called after SDK initialization if desired.\n   */\n  initAutomaticPageTracking() {\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        \"Automatic page tracking skipped due to consent settings.\"\n      )\n      return\n    }\n    // Pass the SDK's trackEvent method, log method, and instance for internal state\n    initAutomaticPageTracking(\n      (eventName, props) => this.trackEvent(eventName, props),\n      this._log, // Changed from #log to _log\n      this // Pass the Adtivity instance itself\n    )\n    this._log(\"info\", \"Automatic page view tracking initialized.\") // Changed from #log to _log\n  }\n\n  /**\n   * Initializes automatic click tracking for elements with `data-adtivity-track` attribute.\n   */\n  initAutomaticClickTracking() {\n    if (!this._config.collectData) {\n      // Changed from #config to _config\n      this._log(\n        // Changed from #log to _log\n        \"debug\",\n        \"Automatic click tracking skipped due to consent settings.\"\n      )\n      return\n    }\n    // Pass the SDK's trackEvent method and log method\n    initAutomaticClickTracking(\n      (eventName, props) => this.trackEvent(eventName, props),\n      this._log // Changed from #log to _log\n    )\n    this._log(\"info\", \"Automatic click tracking initialized.\") // Changed from #log to _log\n  }\n\n  // Add this for Jest testing to reset private static fields\n  static __resetForTesting() {\n    Adtivity._isInitialized = false\n    Adtivity._instance = null\n    Adtivity._deferredCalls = []\n  }\n}\n\n// Global accessor for deferred calls before SDK is fully loaded\n// This allows developers to call `window.Adtivity.trackEvent` even if the script hasn't fully loaded/initialized.\nwindow.Adtivity = window.Adtivity || {\n  // These methods will simply push their arguments to a queue\n  // which the actual SDK instance will process upon initialization.\n  trackEvent: (...args) =>\n    Adtivity._deferredCalls.push([\"trackEvent\", ...args]), // Changed from #deferredCalls to _deferredCalls\n  identify: (...args) => Adtivity._deferredCalls.push([\"identify\", ...args]), // Changed from #deferredCalls to _deferredCalls\n  setConsent: (...args) =>\n    Adtivity._deferredCalls.push([\"setConsent\", ...args]), // Changed from #deferredCalls to _deferredCalls\n  // Allow direct access to get instance for advanced configuration\n  getInstance: (options) => Adtivity.getInstance(options),\n}\n\n// --- Initial setup on DOMContentLoaded (Recommended for most cases) ---\n// This ensures the SDK is initialized once the DOM is ready.\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  // Initialize the Adtivity SDK. Developers will provide their API key here.\n  // `window.adtivityConfig` is a global object developers can define on their page.\n  const adtivityInstance = window.Adtivity.getInstance(\n    window.adtivityConfig || {\n      apiKey: \"YOUR_DEFAULT_OR_FALLBACK_API_KEY\", // Fallback for quick testing\n      debug: true, // Enable debug logging for development\n    }\n  )\n\n  // Automatically initialize common tracking features\n  adtivityInstance.initAutomaticPageTracking()\n  adtivityInstance.initAutomaticClickTracking()\n})\n\n// Fallback for scripts loaded after DOMContentLoaded (e.g., dynamic script injection)\n// This ensures the SDK is initialized if it wasn't by DOMContentLoaded.\nif (document.readyState === \"complete\" && !Adtivity._isInitialized) {\n  // Changed from #isInitialized to _isInitialized\n  window.Adtivity.getInstance(\n    window.adtivityConfig || {\n      apiKey: \"YOUR_DEFAULT_OR_FALLBACK_API_KEY\",\n      debug: true,\n    }\n  )\n}\n\n// Export the Adtivity class for module environments (NPM packages)\nexport { Adtivity }\n"],"names":["initAutomaticClickTracking","trackEventFn","logFn","document","body","addEventListener","event","target","closest","eventName","getAttribute","properties","elementId","id","elementText","innerText","substring","elementType","tagName","href","type","value","className","dataset","adtivityProps","customProps","JSON","parse","e","catch","initAutomaticPageTracking","sdkInstance","trackPageView","originalPushState","history","pushState","_len","arguments","length","args","Array","_key","apply","originalReplaceState","replaceState","_len2","_key2","window","currentPage","location","pathname","search","_lastTrackedPage","pageTitle","title","path","query","fullUrl","setLocalStorageItem","key","localStorage","setItem","console","warn","getLocalStorageItem","getItem","removeLocalStorageItem","removeItem","Adtivity","constructor","options","_config","apiKey","apiBaseUrl","debug","batchSize","flushInterval","maxRetries","retryDelayMs","collectData","_eventQueue","_flushTimer","_isInitialized","_log","error","_loadPersistedEvents","_startFlushTimer","_processDeferredCalls","visibilityState","flushEvents","getInstance","_instance","level","_persistEvents","stringify","persistedQueue","clearInterval","setInterval","_sendBatch","eventsToSend","retryCount","undefined","Promise","reject","Error","url","response","fetch","method","headers","Authorization","keepalive","ok","errorData","json","message","status","statusText","delay","Math","pow","resolve","setTimeout","_queueEvent","eventPayload","push","isUnload","eventsToFlush","unshift","trackEvent","_deferredCalls","payload","timestamp","Date","toISOString","referrer","userAgent","navigator","sessionId","_getSessionId","anonymousId","_getAnonymousId","identify","userId","lastSeen","identifyPayload","setConsent","consentGiven","methodName","shift","props","__resetForTesting","_len3","_key3","_len4","_key4","adtivityInstance","adtivityConfig","readyState"],"mappings":"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"}